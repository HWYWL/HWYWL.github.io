<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Ubuntu18.04修改swap分区大小</title>
      <link href="/2020/02/26/Ubuntu18-04%E4%BF%AE%E6%94%B9swap%E5%88%86%E5%8C%BA%E5%A4%A7%E5%B0%8F/"/>
      <url>/2020/02/26/Ubuntu18-04%E4%BF%AE%E6%94%B9swap%E5%88%86%E5%8C%BA%E5%A4%A7%E5%B0%8F/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h2 id="查看初始状态"><a href="#查看初始状态" class="headerlink" title="查看初始状态"></a>查看初始状态</h2><p>查看原先swap大小</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:~# free -h</span><br><span class="line">              总计         已用        空闲      共享    缓冲/缓存    可用</span><br><span class="line">内存：         62G        417M         38G        3.0M         23G         61G</span><br><span class="line">交换：        2.0G          0B        2.0G</span><br><span class="line">root@gpu-2:~#</span><br></pre></td></tr></tbody></table></figure></div><p>原先swap文件位置</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:~# swapon  -s</span><br><span class="line">文件名             类型      大小       已用  权限</span><br><span class="line">/swapfile1         file      12582908    0   -2</span><br><span class="line">root@gpu-2:~#</span><br></pre></td></tr></tbody></table></figure></div><h2 id="创建一个新的swap文件"><a href="#创建一个新的swap文件" class="headerlink" title="创建一个新的swap文件"></a>创建一个新的swap文件</h2><p>一般swap分区要大于或等于物理内存(1-1.5倍)，最大一般有20G即可，我这里创建12G：</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:~# cd /</span><br><span class="line">root@gpu-2:/# dd if=/dev/zero of=/swapfile1 bs=1G count=12</span><br><span class="line">记录了12+0 的读入</span><br><span class="line">记录了12+0 的写出</span><br><span class="line">12884901888 bytes (13 GB, 12 GiB) copied, 17.1497 s, 751 MB/s</span><br><span class="line">root@gpu-2:/# ll</span><br><span class="line">总用量 14680188</span><br><span class="line">drwxr-xr-x  25 root root        4096 4月  10 17:22 ./</span><br><span class="line">drwxr-xr-x  25 root root        4096 4月  10 17:22 ../</span><br><span class="line">drwxr-xr-x   2 root root        4096 4月  10 06:59 bin/</span><br><span class="line">drwxr-xr-x   4 root root        4096 4月  10 06:59 boot/</span><br><span class="line">drwxrwxr-x   2 root root        4096 3月  25 20:44 cdrom/</span><br><span class="line">drwxr-xr-x   5 netc netc          58 4月   9 14:01 data/</span><br><span class="line">drwxr-xr-x  19 root root        4340 3月  29 07:50 dev/</span><br><span class="line">drwxr-xr-x 127 root root       12288 4月  10 06:59 etc/</span><br><span class="line">drwxr-xr-x   3 root root        4096 3月  25 20:45 home/</span><br><span class="line">lrwxrwxrwx   1 root root          33 4月   3 06:24 initrd.img -> boot/initrd.img-4.18.0-17-generic</span><br><span class="line">lrwxrwxrwx   1 root root          33 4月   4 06:31 initrd.img.old -> boot/initrd.img-4.18.0-16-generic</span><br><span class="line">drwxr-xr-x  21 root root        4096 3月  25 20:56 lib/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 lib64/</span><br><span class="line">drwx------   2 root root       16384 3月  25 20:41 lost+found/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 media/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 mnt/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 opt/</span><br><span class="line">dr-xr-xr-x 323 root root           0 3月  26 10:39 proc/</span><br><span class="line">drwx------   8 root root        4096 3月  26 11:22 root/</span><br><span class="line">drwxr-xr-x  31 root root        1040 4月  10 17:20 run/</span><br><span class="line">drwxr-xr-x   2 root root       12288 4月  10 06:58 sbin/</span><br><span class="line">drwxr-xr-x  12 root root        4096 3月  26 08:54 snap/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 srv/</span><br><span class="line">-rw-------   1 root root  2147483648 3月  25 20:41 swapfile     # 之前的swap文件</span><br><span class="line">-rw-r--r--   1 root root 12884901888 4月  10 17:22 swapfile1    # 新创建的swap文件</span><br><span class="line">dr-xr-xr-x  13 root root           0 4月  10 17:11 sys/</span><br><span class="line">drwxrwxrwt  10 root root       12288 4月  10 17:23 tmp/</span><br><span class="line">drwxr-xr-x  10 root root        4096 2月  10 08:12 usr/</span><br><span class="line">drwxr-xr-x  14 root root        4096 2月  10 08:20 var/</span><br><span class="line">lrwxrwxrwx   1 root root          30 4月   3 06:24 vmlinuz -> boot/vmlinuz-4.18.0-17-generic</span><br><span class="line">lrwxrwxrwx   1 root root          30 4月   4 06:31 vmlinuz.old -> boot/vmlinuz-4.18.0-16-generic</span><br><span class="line">root@gpu-2:/#</span><br></pre></td></tr></tbody></table></figure></div><h2 id="创建swap文件系统"><a href="#创建swap文件系统" class="headerlink" title="创建swap文件系统"></a>创建swap文件系统</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:/# mkswap -f swapfile1</span><br><span class="line">mkswap: swapfile1：不安全的权限 0644，建议使用 0600。</span><br><span class="line">正在设置交换空间版本 1，大小 = 12 GiB (12884897792  个字节)</span><br><span class="line">无标签， UUID=3779f693-8356-42e9-8a2c-2ab51f12654a</span><br><span class="line">root@gpu-2:/# chmod 0600 swapfile1</span><br><span class="line">root@gpu-2:/# ll</span><br><span class="line">总用量 14680188</span><br><span class="line">drwxr-xr-x  25 root root        4096 4月  10 17:22 ./</span><br><span class="line">drwxr-xr-x  25 root root        4096 4月  10 17:22 ../</span><br><span class="line">drwxr-xr-x   2 root root        4096 4月  10 06:59 bin/</span><br><span class="line">drwxr-xr-x   4 root root        4096 4月  10 06:59 boot/</span><br><span class="line">drwxrwxr-x   2 root root        4096 3月  25 20:44 cdrom/</span><br><span class="line">drwxr-xr-x   5 netc netc          58 4月   9 14:01 data/</span><br><span class="line">drwxr-xr-x  19 root root        4340 3月  29 07:50 dev/</span><br><span class="line">drwxr-xr-x 127 root root       12288 4月  10 06:59 etc/</span><br><span class="line">drwxr-xr-x   3 root root        4096 3月  25 20:45 home/</span><br><span class="line">lrwxrwxrwx   1 root root          33 4月   3 06:24 initrd.img -> boot/initrd.img-4.18.0-17-generic</span><br><span class="line">lrwxrwxrwx   1 root root          33 4月   4 06:31 initrd.img.old -> boot/initrd.img-4.18.0-16-generic</span><br><span class="line">drwxr-xr-x  21 root root        4096 3月  25 20:56 lib/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 lib64/</span><br><span class="line">drwx------   2 root root       16384 3月  25 20:41 lost+found/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 media/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 mnt/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 opt/</span><br><span class="line">dr-xr-xr-x 323 root root           0 3月  26 10:39 proc/</span><br><span class="line">drwx------   8 root root        4096 3月  26 11:22 root/</span><br><span class="line">drwxr-xr-x  31 root root        1040 4月  10 17:20 run/</span><br><span class="line">drwxr-xr-x   2 root root       12288 4月  10 06:58 sbin/</span><br><span class="line">drwxr-xr-x  12 root root        4096 3月  26 08:54 snap/</span><br><span class="line">drwxr-xr-x   2 root root        4096 2月  10 08:12 srv/</span><br><span class="line">-rw-------   1 root root  2147483648 3月  25 20:41 swapfile</span><br><span class="line">-rw-------   1 root root 12884901888 4月  10 17:22 swapfile1</span><br><span class="line">dr-xr-xr-x  13 root root           0 4月  10 17:11 sys/</span><br><span class="line">drwxrwxrwt  10 root root       12288 4月  10 17:23 tmp/</span><br><span class="line">drwxr-xr-x  10 root root        4096 2月  10 08:12 usr/</span><br><span class="line">drwxr-xr-x  14 root root        4096 2月  10 08:20 var/</span><br><span class="line">lrwxrwxrwx   1 root root          30 4月   3 06:24 vmlinuz -> boot/vmlinuz-4.18.0-17-generic</span><br><span class="line">lrwxrwxrwx   1 root root          30 4月   4 06:31 vmlinuz.old -> boot/vmlinuz-4.18.0-16-generic</span><br><span class="line">root@gpu-2:/#</span><br></pre></td></tr></tbody></table></figure></div><h2 id="开启新的swap"><a href="#开启新的swap" class="headerlink" title="开启新的swap"></a>开启新的swap</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:/# swapoff /swapfile</span><br><span class="line">root@gpu-2:/# free -h</span><br><span class="line">              总计         已用        空闲      共享    缓冲/缓存    可用</span><br><span class="line">内存：         62G        417M         38G        3.0M         23G         61G</span><br><span class="line">交换：          0B          0B          0B</span><br><span class="line">root@gpu-2:/# swapon /swapfile1</span><br><span class="line">root@gpu-2:/# free -h</span><br><span class="line">              总计         已用        空闲      共享    缓冲/缓存    可用</span><br><span class="line">内存：         62G        420M         38G        3.0M         23G         61G</span><br><span class="line">交换：         11G          0B         11G</span><br><span class="line">root@gpu-2:/#</span><br></pre></td></tr></tbody></table></figure></div><h2 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a>设置开机启动</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@gpu-2:/# vim /etc/fstab</span><br><span class="line">/swapfile                                 none            swap    sw              0       0</span><br><span class="line">改为</span><br><span class="line">/swapfile1                                none            swap    sw              0       0</span><br><span class="line">root@gpu-2:/#</span><br></pre></td></tr></tbody></table></figure></div><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><p>重启，然后查看是否有问题</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r now</span><br></pre></td></tr></tbody></table></figure></div><p>可以先在虚拟机上测试，如果成功的话，再在物理机操作，如果都没问题的话，可以删掉旧的swap文件</p><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /swapfile</span><br></pre></td></tr></tbody></table></figure></div></body></html>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
